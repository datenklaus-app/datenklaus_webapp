{% extends "base.html" %}
{% block content %}
    {% load static %}
    <div class="container text-center">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h1>Raum <span style="color:blue">{{ room_name }}</span></h1>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h3>Aktives Modul</h3>
                <div id="active_module">
                    {% if active_module %}
                        <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-center">
                                <h5 class="mb-1">{{ active_module }}</h5>
                            </div>
                        </a>
                    {% else %}
                        <h5>Kein Modul ausgew채hlt</h5>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-6">
                <h3>Verbundene Sch체ler*innen</h3>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="row justify-content-center">
                            <div class="list-group overflow-auto" id="students">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-start">
            <div class="col-md-6">
                <h3>Verf체gbare Module</h3>
            </div>
        </div>
        <div class="row justify-content-start">
            <div class="col-md-6">
                <div class="list-group overflow-auto" id="modules">
                    {% for m in modules %}
                        <button onclick="module_selected('{{ m.name }}')"
                                class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-center">
                                <h5 class="mb-1">{{ m.name|lower|capfirst }}</h5>
                            </div>
                            <p class="mb-1"></p>
                            <h6 class="mb-1">{{ m.description }}</h6>
                            <p class="mb-1"></p>
                        </button>
                    {% empty %}
                        <a href="#"
                           class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-center">
                                <h5 class="mb-1"> Keine Module verf체gbar</h5>
                            </div>
                        </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block handlebars-template %}
    {% verbatim %}
    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ name }}</h5>
            <small> {{ expiry }}</small>
        </div>
        <p class="mb-1"></p>
        <h6 class="mb-1">{{ progress }}</h6>
        <p class="mb-1"></p>
        <small>ID: {{ session }}</small>
    </a>
    {% endverbatim %}
{% endblock %}
{% block scripts %}
    <script>function module_selected(name) {
        $.ajax({
            method: "POST",
            url: "",
            data: {"type": "module", "module": name},
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            },
            success: function (data) {
                const $el = $("#active_module");
                $el.empty();
                console.log(data)
                $el.append("<h5>" + name + "</h5>")
            }
        })
    };

    function update() {
        $.ajax({
            method: "POST",
            url: "",
            data: {"type": "students"},
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            },
            success: function (data) {
                const $el = $("#students");
                $el.empty(); // remove old options
                console.log(data)
                const source = document.getElementById("student-status-template").innerHTML;
                const template = Handlebars.compile(source);

                $.each(data.students, function (index, value) {
                    const htmlOutput = template(value);
                    $el.append(htmlOutput)
                });
            }
        })
    };
    setInterval(update, 2000)
    </script>
{% endblock %}

</body>
</html>
